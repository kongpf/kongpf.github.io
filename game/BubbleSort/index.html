<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>animate</title>
    <style>
        #canvas {
            position: absolute;
            margin: auto;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
        }

        @font-face {
            font-family: 'Times New Roman';
            src: url('fontzipMin.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }
    </style>
    <script src="https://h.api.4399.com/h5mini-2.0/h5api-interface.php"></script>
    <script src="createjs.js"></script>
    <script src="Loading.js"></script>
    <script src="AdManger.js"></script>
    <script src="decomp.js"></script>
    <script src="matter.js"></script>
    <script src="assets.js"></script>
    <script src="FrameWork.js"></script>
    <script src="Main.js"></script>

    <script>
        var canvas, stage, exportRoot, loadingBg;
        var Queue;
        function init() {
            canvas = document.getElementById("canvas");
            images = images || {};
            stage = new createjs.Stage(canvas);
            loadingBg = new lib.Loading();
            stage.addChild(loadingBg);
            Queue = new createjs.LoadQueue(false);
            Queue.addEventListener("fileload", handleFileLoad);
            Queue.addEventListener("progress", function (e) {
             //   console.log(e.progress)
                loadingBg.progress_bar.progress.x = -(1 - e.progress) * 618;
                stage.update()
            });
            Queue.addEventListener("complete", handleComplete);
            //   loader.load({src:"思源柔黑-Monospace-Bold.ttf"});
            // loader.addEventListener("progress", handleProgress);
            loadFont(function () {
                loadSound(function () {
                    console.log("sound loaded");

                    Queue.loadManifest(lib.properties.manifest);
                })
            })
            makeResponsive(true, 'both', true, 1, [canvas]);//适配宽高
        }
        function handleProgress(evt) {
            console.log(evt.progress);
        }
        function handleFileLoad(evt) {
            if (evt.item.type == "image") { images[evt.item.id] = evt.result; }
        }
        function handleComplete(evt) {
            SceneManger.getInstance().openScene(SceneManger.MENU);
            stage.update();
            stage.enableMouseOver();
            createjs.Ticker.setFPS(lib.properties.fps);
            createjs.Ticker.addEventListener("tick", stage);
        }
        function makeResponsive(isResp, respDim, isScale, scaleType, domContainers) {
            var lastW, lastH, lastS = 1;
            // window.addEventListener('resize', resizeCanvas);
            resizeCanvas();
            function resizeCanvas() {
                var w = lib.properties.width, h = lib.properties.height;
                var iw = window.innerWidth, ih = window.innerHeight;
                var pRatio = window.devicePixelRatio || 1, xRatio = iw / w, yRatio = ih / h, sRatio = 1;
                if (isResp) {
                    if ((respDim == 'width' && lastW == iw) || (respDim == 'height' && lastH == ih)) {
                        sRatio = lastS;
                    }
                    else if (!isScale) {
                        if (iw < w || ih < h)
                            sRatio = Math.min(xRatio, yRatio);
                    }
                    else if (scaleType == 1) {
                        sRatio = Math.min(xRatio, yRatio);
                    }
                    else if (scaleType == 2) {
                        sRatio = Math.max(xRatio, yRatio);
                    }
                }
                domContainers[0].width = w * pRatio * sRatio;
                domContainers[0].height = h * pRatio * sRatio;
                domContainers.forEach(function (container) {
                    container.style.width = w * sRatio + 'px';
                    container.style.height = h * sRatio + 'px';
                });
                stage.scaleX = pRatio * sRatio;
                stage.scaleY = pRatio * sRatio;
                console.log(pRatio, sRatio, w, h)
                lastW = iw; lastH = ih; lastS = sRatio;
                stage.tickOnUpdate = false;
                stage.update();
                stage.tickOnUpdate = true;
            }
        }
        function loadFont(callback) {
            var loader = new createjs.FontLoader("fontzipMin.ttf", true);
            loader.on("complete", callback);
            loader.load();
        }
        function loadSound(callback) {
            console.log("font loaded")
            createjs.Sound.alternateExtensions = ["mp3"];
            var assets = [
                "back.mp3",
                "up.mp3",
                "down.mp3"
            ];
            for (var i = 0; i < assets.length; i++) {
                console.log(assets[i].split(".")[0])
                createjs.Sound.registerSound(assets[i], assets[i].split(".")[0]);
            }
            var num = 0;
            createjs.Sound.addEventListener("fileload", function () {
                num++;
                if (num == assets.length) {
                    console.log("加载完成");
                    callback();
                }
            });
        }
        function playSound(str) {
            createjs.Sound.play(str);
        }
    </script>
</head>

<body onload="init();" style="background-color:#D4D4D4">
    <canvas id="canvas" width="720" height="1280" style="background-color:#FFFFFF"></canvas>
</body>

</html>